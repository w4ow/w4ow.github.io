---
title: C++中的内联函数
date: 2019-07-30 09:45
updated: 2019-07-30 09:45
meta:
    date: false
categories: 
    - Computer Science
    - C & C++
tags:
    - C++
---

内联函数相关知识点梳理

---

<!-- more -->

## 1. 内联函数的作用

引入内联函数inline的主要目的是，用它来代替C或C++中的表达式形式的宏定义，从而解决程序中函数调用的效率问题。在C或C++中，可以如下定义一个宏：

```c++
#define Expression(a, b) (((a) + (b)) * ((a) - (b)))
```

该宏定义用于计算两数的和差积。这种宏在形式上类似于函数，但它**使用预处理器实现**，没有参数压栈、代码生成等操作，因而效率很高。但与此同时，这种宏**不能进行参数有效性检测**，不能享受C++编译器类型检查带来的好处，因此这种宏的使用有一定的隐患和局限性。

另外，在C++的类中，当一个操作涉及到保护成员和私有成员时，类的访问控制机制使得这些成员不能通过上面的宏进行操作。

为此，inline推出的作用就是取代这种表达式形式的宏定义，消除表达式宏的缺点，继承表达式宏的优点。

## 2. inline与宏定义的区别

- inline函数的本质是一个函数，而宏不是；


- inline函数在编译时展开，宏在预编译时展开；


- 在编译时，inline函数可以直接被嵌入到目标代码中，而宏只是一个简单的文本替换；


- inline可以完成参数类型检查、语法检查等编译功能，宏则不具备这样的功能；


- 宏定义时容易出现二义性(一般需要加很多括号以解决这个问题)，inline则不会出现这样的问题(本质是函数)。

## 3. inline的优点

- inline定义的类的内联函数，函数的代码被放入符号表中，在使用时直接进行替换，像宏一样展开，没有了调用的开销，效率很高；


- 类的内联函数是一个真正的函数，在调用一个内联函数时，编译器会对其进行参数类型检查等相关检查，消除了隐患和局限性；


- inline可以作为某个类的成员函数，可以使用所在类的保护成员变量和私有成员变量。

## 4. inline的使用场合

- 用于取代表达式形式的宏定义；


- 用于C++类中私有成员或保护成员的存取函数定义。一般而言，类的外部想要访问类的私有成员，需要使用接口函数来对这些私有成员进行读写，如果将这些读写私有成员的函数定义为内联函数则能获得较高的效率(符号表替换)。需要注意的是，**定义在类体内的函数会被自动转换成内联函数**。

## 5. inline的缺点

**inline是以代码复制为代价的**，仅仅省去了函数调用的开销，从而提高函数的执行效率。**若函数体内代码的执行时间相比于函数调用的开销大，那么使用inline的效率收益则较低**。另外，**每一处内联函数的调用都需要复制代码**，会使程序的总代码量增大，消耗更多的内存空间。因此以下情况下不适合使用inline：

- 函数体内代码较长：使用inline将导致较高的内存消耗；


- 函数体内出现循环：执行函数体内的代码的时间会比函数调用的开销大；


- 不用于类的构造函数和析构函数。
