---
title: TCP中的拥塞控制简介
date: 2015-05-27 21:12
updated: 2015-05-27 21:12
mathjax: true
photos: 
meta:
    date: false
categories: 
    - Computer Science
    - Computer Network
tags:
    - Network
---

TCP中的拥塞控制的目的是控制网络拥塞的出现，网络拥塞的原因多种多样，比如某结点的缓存太小、某段链路带宽太低等等。为了防止网络拥塞，V.Jacobson在1988年的论文中提出了用于TCP的拥塞控制，由慢开始和拥塞避免组成，后来在TCP Reno版本中又加入了快重传和快恢复。这4种技术能够很好的避免网络拥塞。

---

<!-- more -->

## 1. 慢开始

如果将网络通路比作高速公路，那么我们可以想象一下，如果这条路的出口只有一个车道，而入口却有很多车道，那么这条路必然会造成拥塞。慢开始就是针对这一情况而提出的。其基本思想是逐渐增大发送的数据大小(即拥塞窗口)直到指定的阈值(即慢开始阈值)。

在慢开始中，发送端除了要维护正常情况下根据接收端发来的窗口大小字段值而调整的**发送窗口**外，还要维护一个**拥塞窗口(Congestion Window, CWND)**，CWND的目的是为了避免发生拥塞，最终**允许发送的字节数是CWND和发送窗口两者中的最小值**。

下面介绍慢开始的具体步骤(假设CWND总是小于发送窗口)：

1. 在TCP传输连接建立时，发送端将CWND初始化为该连接上当前使用的最大数据段大小(Maximum Segment Size, MSS)，即CWND=MSS，然后发送端发送一个MSS大小的数据段M1。
2. 如果在定时器过期前发送端收到了该数据段的确认(即对M1的确认)，则发送端将CWND大小翻倍，即CWND=2MSS，并发送2MSS大小的数据，假定发送的数据段位M2、M3。
3. 同样的，如果在定时器过期前发送端接收到确定(收到M3的确认即可，即只用确认最后一个)，再次将CWND翻倍，并以此类推。
4. 当出现数据丢失时，需要将**慢开始阈值(Slow Start Threshold, SSTHRESH)**设置为当前CWND的一半，并将CWND重设为1MSS。并重新开始慢开始，此时若CWND再次达到SSTHRESH便停止使用慢开始，转用拥塞避免。

值得注意的是，一般SSTHRESH初始值为64KB。

![](https://raw.githubusercontent.com/w4ow/figure_for_blog/master/13afefqewf23232f.png)

## 2. 拥塞避免

拥塞避免的基本思想是，当CWND再次达到SSTHRESH时，让拥塞窗口的大小每经过一个RTT(数据传输往返时间)时仅增加1MSS。如果这时还是发生了数据丢失，同样的还是把SSTHRESH设为当前CWND的一半，把CWND设为1MSS，并重新开始慢开始。

## 3. 快重传/快恢复

快重传的基本思想是，当接收端收到一个不是按序到达的数据段时，TCP实体迅速发送一个重复ACK数据段，而不用等到有数据需要发送时才顺带发出重复ACK。在连续收到3个重复ACK数据段后，即认为对应确认号字段的数据丢失，TCP不等重传定时器超时就会重传丢失的数据段。

快恢复是在快重传发挥作用时，确切的说是收到第三个重复ACK时，把当前CWND设为当前SSTHRESH的一半，以减轻网络负载，然后执行拥塞避免算法。
