---
title: 进程、线程与协程之间的区别与联系
date: 2015-03-12 14:12
updated: 2015-03-12 14:12
mathjax: true
meta:
    date: false
categories: 
    - Computer Science
    - Operating System
tags:
    - Process
---

进程、线程与协程之间的区别与联系

---

<!-- more -->

## 1. 进程

进程是程序的动态执行。保存在硬盘上的程序运行以后，会在内存空间里形成一个独立的内存体，这个内存体有自己独立的地址空间，有自己的堆，上级挂靠单位是操作系统。操作系统会以进程为单位，分配系统资源（CPU时间片、内存等资源），**进程是资源分配的最小单位**。一块CPU在某一时刻只能运行一个进程，多进程是通过进程调度抢占CPU来实现的。

**进程间的通信方式**

无名管道(Pipe)、有名管道(FIFO)、消息队列(Message Queue) 、信号量(Semaphore) 、共享内存(Shared Memory)、套接字(Socket)。

## 2. 线程

线程也被称为轻量级进程(Lightweight Process，LWP)，是操作系统调度(CPU调度)执行的最小单位。

### 2.1 线程与进程的区别与联系

**联系**

1. 一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程；
2. 资源分配给进程，同一进程的所有线程共享该进程的所有资源；
3. 处理机分给线程，即真正在处理机上运行的是线程；
4. 线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。

**区别**

1. 调度：线程作为调度和分配的基本单位，进程作为拥有资源的基本单位；
2. 并发性：不仅进程之间可以并发执行，同一个进程的多个线程之间也可并发执行；
3. 拥有资源：进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属进程的资源。进程维护的是程序所包含的资源(静态资源)，如：地址空间、打开的文件句柄集、文件系统状态、信号处理handler等；线程所维护的运行相关的资源(动态资源)，如：运行栈、调度相关的控制信息、待处理的信号集等；
4. 系统开销：在创建或撤消进程时，由于系统都要为之分配和回收资源，导致创建进程的系统开销明显大于创建或撤消线程时的开销。但是进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响。而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个进程死掉就等于所有的线程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。

## 3. 协程

协程，是一种比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是由程序所控制(也就是在用户态执行)。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。

子程序，或者称为函数，在所有语言中都是层级调用，比如A调用B，B在执行过程中又调用了C，C执行完毕返回，B执行完毕返回，最后是A执行完毕。所以子程序调用是通过栈实现的，一个线程就是执行一个子程序。子程序调用总有一个入口，一次返回，并且调用顺序是明确的。而协程的调用和子程序不同，协程在子程序内部是可中断的，然后转而执行别的子程序，在适当的时候再返回来接着执行。

**协程的优点**

1. 极高的执行效率：因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显；
2. 不需要多线程的锁机制：因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。

